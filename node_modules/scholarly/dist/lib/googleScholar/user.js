"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseUserArticle = void 0;
var utils_1 = require("../utils");
var config_1 = require("../config");
var cheerio_1 = __importDefault(require("cheerio"));
/**
 *
 *
 * @param {CheerioStatic} $
 * @param {CheerioElement} div
 * @param {IHTMLTags} tags
 * @returns
 */
var _parseUserArticle = function ($, div, tags) {
    if ($) {
        var article = new config_1.Article();
        if (tags.title)
            article.title = $(div).find(tags.title).text().trim();
        if (tags.year)
            article.year = parseInt($(div).find(tags.year).text());
        if (tags.citations)
            article.numCitations = parseInt($(div).find(tags.citations).text()) || 0;
        var articleData = $(div).find(tags.authors);
        article.authors = $(articleData[0]).text().split(",");
        // Remove hidden year attribute
        $(articleData[1]).find(".gs_oph").remove();
        var htmlString = $(articleData[1]).text().trim();
        var idx = (0, utils_1.splitJournalVolumeString)(htmlString);
        article.journal = htmlString.slice(0, idx).trim();
        htmlString = htmlString.substr(idx);
        if (htmlString === "")
            return article;
        var articleTokens = htmlString.split(",");
        var _a = (0, utils_1.splitVolumeIssueString)(articleTokens[0]), volume = _a.volume, issue = _a.issue;
        article.volume = volume;
        article.issue = issue;
        if (articleTokens.length > 1)
            article.pages = articleTokens[1].trim();
        return article;
    }
};
var parseUserArticle = function (html, tags) {
    var articles = [];
    var $ = cheerio_1.default.load(html);
    var allResults = $(tags.results);
    allResults.each(function (_, div) {
        var article = _parseUserArticle($, div, tags);
        if (article && article.title !== "")
            articles.push(article);
    });
    return articles;
};
exports.parseUserArticle = parseUserArticle;
